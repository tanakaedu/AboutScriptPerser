# TyranoScriptV5Perser
ティラノスクリプトV5のシナリオファイルを読み込んで、タグやデータに分解するパーサーを作成する手順のメモです。

ティラノビルダーで作成した会話シーンを、Unityなどへ移植する時にシナリオファイルをどのように分析すればよいかの例を示します。


## 想定環境
- ティラノスクリプトV5
- Unity2019.4.x

## ティラノスクリプトの基本をおさえる
[TYRANO SCRIPT. 文字を表示する](https://tyrano.jp/usage/tutorial/moji)を読んで、基本的な文法を把握します。

- シナリオはプロジェクトフォルダーの`data\scenario`フォルダー内にある
- `;`から始まる行は行末までコメント
- `*`から始まる行はラベル定義
- `[]`で囲まれた部分はタグで、何らかの動きを表す
- タグは`@`で始めることも可能。`[]`は文章中に埋め込むことができるのに対して、`@`は1行で完結させる必要がある
- タグには属性を持つものがある。属性は半角スペースで区切り、パラメーターを持つ場合は`=`に続けて書く。パラメーターは`"`で囲む場合と、囲まない場合がある
- `#`で始まる行は、キャラ名の指定。詳しくは https://tyrano.jp/usage/tech/chara
- `@`で始まる行はジャンプ。ジャンプ先をパラメーターで指定する
- 空行は無視
- 上記以外の文字はセリフ

まずは以上を前提に、スクリプトファイルをコマンドとパラメーターに分割する機能を作成する。

## 分割の仕方
渡されたテキストファイルを上記のルールに基づいて分解して、コマンドと属性と属性の値に分解します。例えば、以下のデフォルトスクリプトを渡したとします。

```ks
;チュートリアル用スクリプトファイル
*start

[wait time=200]

吾輩わがはいは猫である。名前はまだ無い。[l][r]

どこで生れたかとんと見当けんとうがつかぬ。[l][cm]

何でも薄暗いじめじめした所でニャーニャー泣いていた事だけは記憶している。[l]

吾輩はここで始めて人間というものを見た。[l][r]
```

これを以下のように出力します。

```
label value=start
wait time=200
serif value=吾輩わがはいは猫である。名前はまだ無い。
l
r
serif value=どこで生れたかとんと見当けんとうがつかぬ。
l
cm
serif value=何でも薄暗いじめじめした所でニャーニャー泣いていた事だけは記憶している。
l
serif value=吾輩はここで始めて人間というものを見た。
l
r
```

もう一つ例示します。

```ks
[position layer=message0 width=800 height=300 top=380 left=70 ]
[position layer=message0 page=fore frame="frame.png" margint="65" marginl="50" marginr="70" marginb="60"]
[cm]
メッセージウィンドウが下に表示されましたね？[r][l]
ここにメッセージが表示されています。[r][l]
ここにメッセージが表示されています。[r][l]
```

以下のように出力します。

```
position layer=message0 width=800 height=300 top=380 left=70
position layer=message0 page=fore frame=frame.png margint=65 marginl=50 marginr=70 marginb=60
cm
serif value=メッセージウィンドウが下に表示されましたね？
r
l
serif value=ここにメッセージが表示されています。
r
l
serif value=ここにメッセージが表示されています。
r
l
```

このように、コマンドや空行などを取り除いて、最初にコマンドを表す文字列、属性があれば半角スペースで区切って続けます。属性の名前がない場合は、`value`を名前として、`=`に続けて値を記載します。値がない場合は`=`以降は省略します。

このように分解することで、最初の文字列で処理を分岐して、分岐先で属性を読み取って必要な処理を実行するようにすれば、プレイヤーを実装することができます。

## 参考URL
- [TYRANO SCRIPT V5](https://tyrano.jp/usage/tutorial/ready_v5)

## ライセンス
MITライセンス
Copyright (C) 2021 たなかゆう
